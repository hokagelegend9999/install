#!/bin/bash

# ==============================================
# SCRIPT SINGKAT UNTUK MASUK KE CONTAINER VPN
# ==============================================

CONTAINER_NAME="vpn-container"

# Fungsi untuk menampilkan pesan
function show_msg() {
    echo -e "\033[1;36m>>> $1\033[0m"
}

function show_error() {
    echo -e "\033[1;31m!!! $1\033[0m"
}

# Buat alias permanen
function setup_alias() {
    if ! grep -q "alias menu=" ~/.bashrc; then
        echo "alias menu='lxc exec $CONTAINER_NAME -- bash'" >> ~/.bashrc
        source ~/.bashrc
        show_msg "Alias 'menu' telah ditambahkan. Sekarang Anda bisa ketik 'menu' saja untuk masuk container."
    else
        show_msg "Alias 'menu' sudah ada. Anda bisa langsung ketik 'menu' untuk masuk container."
    fi
}

# Cek apakah container ada dan running
function check_container() {
    if ! lxc list --format csv | grep -q "$CONTAINER_NAME,RUNNING"; then
        show_error "Container $CONTAINER_NAME tidak berjalan atau tidak ada"
        read -p "Apakah Anda ingin mencoba memulai container? [y/N] " yn
        case $yn in
            [Yy]* ) 
                lxc start $CONTAINER_NAME
                if lxc list --format csv | grep -q "$CONTAINER_NAME,RUNNING"; then
                    show_msg "Container berhasil dimulai"
                    return 0
                else
                    show_error "Gagal memulai container"
                    return 1
                fi
                ;;
            * ) 
                return 1
                ;;
        esac
    fi
    return 0
}

# Main program
setup_alias

show_msg "Memeriksa container..."
if check_container; then
    show_msg "Anda sekarang bisa menggunakan perintah:"
    echo -e "\n  \033[1;32mmenu\033[0m\n"
    echo "Untuk masuk ke container VPN, ketik 'menu' saja tanpa tanda kutip"
else
    show_error "Tidak dapat melanjutkan. Pastikan container $CONTAINER_NAME ada dan berjalan."
fi
