#!/bin/bash

# ==============================================
# SCRIPT INSTALASI CONTAINER LXD - VERSI DEFINITIF
# ==============================================

# ... (bagian sebelumnya tetap sama)

# 5. Membuat skrip menu interaktif
show_msg "5. Membuat skrip menu interaktif..."
MENU_SCRIPT="/usr/local/bin/vpn-menu"

sudo tee $MENU_SCRIPT > /dev/null <<'EOF'
#!/bin/bash

CONTAINER_NAME="vpn-container"

function header() {
    clear
    echo "==========================================="
    echo " VPN CONTAINER MANAGEMENT - $CONTAINER_NAME"
    echo "==========================================="
}

function container_status() {
    STATUS=$(lxc list -c s --format csv $CONTAINER_NAME)
    if [[ "$STATUS" == "RUNNING" ]]; then
        echo -e "Status: \033[1;32m$STATUS\033[0m"
    else
        echo -e "Status: \033[1;31m$STATUS\033[0m"
    fi
}

function main_menu() {
    header
    container_status
    echo -e "\nMenu Utama:"
    echo "1) Masuk ke Container (Shell)"
    echo "2) Restart Container"
    echo "3) Stop Container"
    echo "4) Start Container"
    echo "5) Cek Status Container"
    echo "6) Informasi Container"
    echo "7) Keluar"
    echo -e "\nPilih opsi [1-7]: \c"
}

while true; do
    main_menu
    read choice
    case $choice in
        1)
            echo "Memasuki container..."
            lxc exec $CONTAINER_NAME -- bash
            ;;
        2)
            echo "Merestart container..."
            lxc restart $CONTAINER_NAME
            sleep 2
            ;;
        3)
            echo "Menghentikan container..."
            lxc stop $CONTAINER_NAME
            sleep 2
            ;;
        4)
            echo "Menjalankan container..."
            lxc start $CONTAINER_NAME
            sleep 2
            ;;
        5)
            echo -e "\nStatus container:"
            lxc list $CONTAINER_NAME
            echo -e "\nTekan enter untuk melanjutkan..."
            read
            ;;
        6)
            echo -e "\nInformasi detail container:"
            lxc info $CONTAINER_NAME
            echo -e "\nTekan enter untuk melanjutkan..."
            read
            ;;
        7)
            echo "Keluar dari menu."
            exit 0
            ;;
        *)
            echo "Pilihan tidak valid! Silakan pilih 1-7."
            sleep 2
            ;;
    esac
done
EOF

sudo chmod +x $MENU_SCRIPT

show_success "Skrip menu berhasil dibuat"
echo -e "Anda sekarang bisa mengelola container dengan perintah: \033[1;32mvpn-menu\033[0m"

# ==============================================
# AKHIR SCRIPT
# ==============================================
