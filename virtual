#!/bin/bash

if [ "$(id -u)" -ne 0 ]; then
  echo "âŒ Jalankan sebagai root (sudo)"
  exit 1
fi

echo "ğŸ”¥ Menghapus semua container LXD jika ada..."

if command -v lxc >/dev/null 2>&1; then
  containers=$(lxc list --format csv -c n | grep -v -E '^$|Installing|pending|Stopping|Starting')

  for container in $containers; do
    echo "â³ Menghentikan container: $container"
    lxc stop "$container" --force || echo "âš ï¸ Gagal menghentikan $container, lanjut..."
    echo "ğŸ—‘ï¸ Menghapus container: $container"
    lxc delete "$container" || echo "âš ï¸ Gagal menghapus $container, lanjut..."
  done
else
  echo "â„¹ï¸ LXC tidak ditemukan, melewati penghapusan container"
fi

echo "ğŸ›‘ Mematikan layanan dan socket LXD..."
systemctl stop snap.lxd.daemon.service snap.lxd.daemon.unix.socket 2>/dev/null
systemctl disable snap.lxd.daemon.service snap.lxd.daemon.unix.socket 2>/dev/null

echo "ğŸ“¦ Menghapus snap LXD..."
snap remove lxd --purge 2>/dev/null || echo "â„¹ï¸ Snap LXD tidak terpasang"

echo "ğŸ§¹ Membersihkan direktori data LXD..."
rm -rf /var/snap/lxd ~/snap/lxd

# Hapus alias 'menu' dari /etc/bash.bashrc jika ada
if grep -q "^alias menu=" /etc/bash.bashrc; then
  sed -i '/^alias menu=/d' /etc/bash.bashrc
  echo "ğŸ§¹ Alias 'menu' dihapus dari /etc/bash.bashrc"
fi

echo "âœ… Semua data dan konfigurasi LXD sudah dibersihkan."
