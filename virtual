#!/bin/bash

# =============================================
# INSTALLER LXC UBUNTU 20.04 - VERSI FINAL
# =============================================
# Fix: Alias bekerja di host saja, tidak di container
# By: Chatbot AI Assistant
# =============================================

# [Bagian awal script sama dengan sebelumnya...]

# =============================================
# 4. SETUP PERINTAH CEPAT (REVISI)
# =============================================
show_msg "4. Membuat Perintah Cepat..."

# Hanya buat alias di HOST (bukan di container)
cat <<EOF >> ~/.bashrc

# LXC Legacy Env Commands
alias virtual="lxc exec legacy-script-env -- bash"
alias lxc-user="lxc exec legacy-script-env -- sudo -u scriptuser -i"
alias lxc-stop="lxc stop legacy-script-env"
alias lxc-start="lxc start legacy-script-env"
alias lxc-list="lxc list"
EOF

# Buat file helper di container
lxc exec legacy-script-env -- bash -c "cat <<'EOF' > /root/.lxc_help
# HELP: Legacy Script Environment
Untuk keluar dari container, gunakan:
- 'exit' atau tekan 'Ctrl+D'

Perintah manajemen dari HOST:
- virtual    : Masuk ke container
- lxc-user   : Masuk sebagai user
- lxc-stop   : Matikan container
- lxc-start  : Hidupkan container
- lxc-list   : Lihat daftar container
EOF"

# Tambahkan pesan welcome di container
lxc exec legacy-script-env -- bash -c "echo 'cat /root/.lxc_help' >> /root/.bashrc"

# =============================================
# 5. SELESAI (REVISI)
# =============================================
show_msg "5. Instalasi Selesai!"
echo -e "\n\e[1;32mSUKSES!\e[0m Container Ubuntu 20.04 siap digunakan"
echo -e "\n\e[1;33mPERINTAH HOST:\e[0m"
echo -e "  \e[1;36mvirtual\e[0m    - Masuk ke container sebagai root"
echo -e "  \e[1;36mlxc-user\e[0m   - Masuk sebagai user biasa"
echo -e "  \e[1;36mlxc-stop\e[0m   - Matikan container"
echo -e "  \e[1;36mlxc-start\e[0m  - Hidupkan container"
echo -e "  \e[1;36mlxc-list\e[0m   - Lihat daftar container"

echo -e "\n\e[1;33mDI DALAM CONTAINER:\e[0m"
echo -e "  \e[1;36mexit\e[0m       - Keluar dari container"
echo -e "  \e[1;36mCtrl+D\e[0m     - Keluar dari container"

# Masuk otomatis
read -p $'\nMasuk ke container sekarang? (y/n) ' -n 1 -r
if [[ $REPLY =~ ^[Yy]$ ]]; then
    lxc exec legacy-script-env -- bash
fi
