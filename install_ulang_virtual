#!/bin/bash

# Cek root
if [ "$(id -u)" -ne 0 ]; then
  echo "❌ Jalankan script ini sebagai root (sudo)"
  exit 1
fi

echo "🔥 Menghapus semua container LXD..."
lxc list --format csv -c n | while read -r container; do
  if [ -n "$container" ]; then
    echo "⏳ Menghentikan container: $container"
    lxc stop "$container" --force
    echo "🗑️ Menghapus container: $container"
    lxc delete "$container"
  fi
done

echo "🔁 Mereset konfigurasi LXD..."
lxd init --reset

echo "🛑 Menghentikan layanan LXD..."
systemctl stop snap.lxd.daemon

echo "📦 Menghapus snap LXD..."
snap remove lxd --purge

echo "🧹 Membersihkan direktori data LXD..."
rm -rf /var/snap/lxd
rm -rf ~/snap/lxd

echo "✅ Semua data dan konfigurasi LXD sudah dihapus bersih."
