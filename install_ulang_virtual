#!/bin/bash

# Cek root
if [ "$(id -u)" -ne 0 ]; then
  echo "âŒ Harap jalankan script ini sebagai root (sudo)"
  exit 1
fi

echo "ğŸ”¥ Menghapus semua container LXD..."
lxc list --format csv -c n | while read -r container; do
  if [ -n "$container" ]; then
    echo "â³ Menghentikan container: $container"
    lxc stop "$container" --force
    echo "ğŸ—‘ï¸ Menghapus container: $container"
    lxc delete "$container"
  fi
done

echo "ğŸ” Mereset konfigurasi LXD..."
lxd init --reset

echo "ğŸ§¼ Menghapus semua data LXD..."
systemctl stop snap.lxd.daemon

echo "ğŸ“¦ Menghapus snap LXD..."
snap remove lxd --purge

echo "ğŸ§¹ Membersihkan direktori LXD..."
rm -rf /var/snap/lxd
rm -rf ~/snap/lxd

echo ""
echo "âœ… Semua data LXD telah dihapus bersih."
echo "ğŸ“Œ LXD tidak diinstall ulang."
